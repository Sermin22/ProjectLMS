# LMS Django Backend
Этот проект — бэкенд-часть системы онлайн-обучения (LMS, Learning Management System).
Он разработан как учебный проект для реализации платформы, где каждый 
желающий может размещать свои курсы и обучающие материалы.

Результатом данного проекта является серверная часть (бэкенд), которая возвращает 
данные в формате JSON. Визуальное отображение данных (frontend) на данном этапе не реализуется.

## Стек технологий
- Python 3.13

- Django

- Django REST Framework (DRF)

## Установка и запуск проекта

1. Клонировать репозиторий:

```
https://github.com/Sermin22/ProjectLMS
```
2. Установить зависимости:

```
poetry install
```
3. Создать базу данных.
4. Создать .env файл в корне проекта и указать необходимые переменные окружения. 
Пример файла - .env_template
5. Выполнить миграции:

```
python manage.py migrate
```

## Запустить сервер разработки:

```
python manage.py runserver
```

## Структура проекта

### Приложение users:
Модель CustomUser (кастомный User):

- Email (используется для авторизации)

- Телефон

- Город

- Аватар

Модель Payments:

- пользователь,
- дата оплаты,
- оплаченный курс,
- оплаченный урок,
- сумма оплаты,
- способ оплаты: наличные или перевод на счет.

Поля пользователь, оплаченный курс и отдельно оплаченный урок
имееют внешние ссылки ForeignKey на соответствующие модели.

Настроена фильтрация для эндпоинта вывода списка платежей с возможностями:

- менять порядок сортировки по дате оплаты,
- фильтровать по курсу или уроку,
- фильтровать по способу оплаты.

### Приложение lms:
Модель Course:
- название;
- превью (картинка);
- описание.

Модель Lesson:
- название;
- описание;
- курс (поле связано через ForeignKey (один ко многим) с моделью Course);
- превью (картинка);
- ссылка на видео.

Модель Subscription:
- пользователь;
- курс.

Модель подписки на обновления курса для пользователя. Модель подписки содержит 
следующие выше поля: «пользователь» (FK на модель пользователя) и «курс» (FK на модель
курса). Реализован эндпоинт для установки подписки пользователя и на ее удаление.

## Функциональность
Реализован CRUD (Create, Read, Update, Delete):

✅ Для модели Course — с помощью ViewSets

✅ Для модели Lesson — с помощью Generic-классов

Каждый эндпоинт протестирован с помощью Postman.

✅ Для модели Lesson - вывод списка уроков с помощью generics.ListAPIView.

Вывод реализован с помощью сериализатора для связанной модели.

Сериализатор выдает и количество уроков курса и информацию по всем урокам курса одновременно.

✅ Для модели CustomUser - с помощью Generic-классов.

Настроено использование JWT-авторизации и закрыт каждый эндпоинт авторизацией.

Эндпоинты для авторизации и регистрации доступны для неавторизованных пользователей.

✅Подключена возможность оплаты курсов через https://stripe.com/docs/api.

✅Проект настроен для работы с Celery и с celery-beat для выполнения периодических задач.

Добавлена асинхронная рассылка писем пользователям об обновлении материалов курса
(уведомление отправляется только в том случае, если курс не обновлялся более четырех часов).

С помощью celery-beat реализована фоновая задача, которая проверяет пользователей 
по дате последнего входа, и если пользователь не заходил более месяца, 
блокирует его, то есть делает неактивным.
Задачу периодическая и по расписанию запланирован проверка в настройках celery-beat рай в день.

## Разграничение прав доступа

Заведена группа модераторов ("moders") и описаны для нее права работы с любыми уроками 
и курсами, но без возможности их удалять и создавать новые. Заложен функционал такой 
проверки в контроллеры.

Описаны права доступа для объектов таким образом, чтобы пользователи, которые не 
входят в группу модераторов, могут видеть, редактировать и удалять только свои курсы 
и уроки.

Загрузить группу из фикстуры можно командой:
```
python manage.py loaddata groups.json
```

## Пагинация

Реализована пагинация с выводом 5-ти элементов на странице с возможностью их
увеличивать максимум до 100.

## Тестирование

Реализованы тесты, которые проверяют корректность работы CRUD уроков и функционал 
работы подписки на обновления курса.
Обработаны возможные варианты взаимодействия с контроллерами пользователей с 
разными правами доступа.

Сохранен результат проверки покрытия тестами.

## Документация к проекту

Подключен и настроен вывод документации для проекта, которую можно посмотреть по ссылкам:
```
/swagger/
/redoc/
```

## Структура репозитория
users/ — приложение для пользователей

lms/ — приложение для курсов и уроков

pyproject.toml — зависимости проекта

.gitignore — исключенные из контроля файлы и папки (например, venv, pycache и др.)

README.md — описание проекта (этот файл)

## Проверка работы

После запуска сервера доступ к API осуществляется через Postman или любой HTTP-клиент.

Примеры эндпоинтов:

/lms/courses/ — список курсов

/lms/courses/{id}/ — детали курса

/lms/lessons/ — список уроков

/lms/lessons/{id}/ — детали урока

## Запуск проекта с помощью Docker Compose

Для удобства запуска и разворачивания проекта используется docker-compose. Это позволяет 
поднять все необходимые сервисы (Django-приложение, база данных, Redis и Celery) 
одной командой.

### Структура docker-compose

В проекте настроены следующие сервисы:

- web — основной Django-бэкенд

- db — PostgreSQL база данных

- redis — брокер сообщений для Celery

- celery — фоновый воркер для асинхронных задач

- celery-beat — планировщик задач для Celery

### Шаги для запуска

1.Убедитесь, что у вас установлен Docker и Docker Compose.

2.Клонируйте репозиторий:
```
git clone https://github.com/Sermin22/ProjectLMS.git
cd ProjectLMS
```
3. Создайте .env файл в корне проекта и укажите необходимые переменные окружения. 
Пример файла - .env_template
4. Запустите проект:
```
docker-compose up -d --build
```
Первый запуск может занять несколько минут, так как будут устанавливаться зависимости, 
применяться миграции и запускаться фоновые процессы.

5. После запуска загрузите тестовые данные (по желанию) группу модераторов ("moders"):
```
docker-compose exec web python manage.py loaddata groups.json
```
6. После запуска создайте суперюзера (по желанию):
```
docker-compose exec web python manage.py createsuperuser
```

### Проверка работоспособности сервисов

| Сервис          | Описание                     | Проверка                                                                |
| --------------- | ---------------------------- | ----------------------------------------------------------------------- |
| **Django API**  | Основной бэкенд              | Перейдите в браузере на: [http://localhost:8000](http://localhost:8000) |
| **Swagger UI**  | Документация API             | [http://localhost:8000/swagger/](http://localhost:8000/swagger/)        |
| **ReDoc**       | Альтернативная документация  | [http://localhost:8000/redoc/](http://localhost:8000/redoc/)            |
| **PostgreSQL**  | База данных                  | Автоматически подключается к Django                                     |
| **Redis**       | Очередь сообщений для Celery | Проверяется при запуске Celery                                          |
| **Celery**      | Фоновые задачи               | При логировании в терминал видно выполнение задач                       |
| **Celery Beat** | Периодические задачи         | Задачи запускаются согласно расписанию                                  |

**Вы можете также подключиться к контейнеру для отладки:**
```
docker-compose exec web bash
```

### Остановка проекта

Для остановки всех сервисов:
```
docker-compose down
```

Если нужно удалить тома базы данных и кэша:
```
docker-compose down -v
```

## Автор
Sergei, msm2203@mail.ru
```
https://github.com/Sermin22/
```
